@model List<Proyecto1_PAW.Models.RolModel>

@{
    ViewBag.Title = "Gestión de Roles";
}

<style>
    h2 {
        color: #004a99;
        margin-bottom: 15px;
    }

    a {
        color: #004a99;
        text-decoration: none;
        font-weight: 600;
    }

        a:hover {
            text-decoration: underline;
        }

    table {
        border-collapse: collapse;
        width: 100%;
        max-width: 800px;
        margin-top: 10px;
        background-color: #fff;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 8px 10px;
        text-align: left;
    }

    th {
        background-color: #f0f4ff;
        font-weight: bold;
    }

    tr:hover {
        background-color: #f5f9ff;
    }

    button {
        background-color: #d9534f;
        color: #fff;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
    }

        button:hover {
            background-color: #c9302c;
        }

    #crearRol {
        margin-top: 20px;
        padding: 15px;
        border-left: 4px solid #004a99;
        background-color: #f9faff;
        max-width: 400px;
    }

        #crearRol h3 {
            margin-top: 0;
            color: #004a99;
        }

        #crearRol label {
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }

        #crearRol input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-top: 4px;
        }

        #crearRol button[type="submit"] {
            background-color: #004a99;
        }

            #crearRol button[type="submit"]:hover {
                background-color: #0066cc;
            }

    #cancelar {
        background-color: #777;
        margin-left: 10px;
    }

        #cancelar:hover {
            background-color: #555;
        }
</style>


<h2>Gestión de Roles</h2>

<p>
    <a href="/Panel/Index">Volver al Panel</a> |
    <a href="/Rol/ListaUsuarios">Ver usuarios y roles asignados</a> |
    <a href="#" id="btnNuevoRol">Crear nuevo rol</a>
</p>

<hr />

<table border="1" cellpadding="6" cellspacing="0">
    <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Descripción</th>
        <th>Acciones</th>
    </tr>
    @foreach (var rol in Model)
    {
        <tr>
            <td>@rol.Id</td>
            <td>@rol.Nombre</td>
            <td>@rol.Descripcion</td>
            <td>
                <button class="btnEliminar" data-id="@rol.Id">Eliminar</button>
            </td>
        </tr>
    }
</table>

<div id="crearRol" style="display:none; margin-top:20px;">
    <h3>Crear nuevo rol</h3>
    <form id="formRol">
        <label>Nombre del rol:</label><br />
        <input type="text" id="nombre" name="nombre" required /><br />

        <label>Descripción:</label><br />
        <input type="text" id="descripcion" name="descripcion" /><br /><br />

        <button type="submit">Guardar</button>
        <button type="button" id="cancelar">Cancelar</button>
    </form>
</div>

<hr />

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    document.getElementById("btnNuevoRol").addEventListener("click", function (e) {
        e.preventDefault();
        document.getElementById("crearRol").style.display = "block";
    });

    document.getElementById("cancelar").addEventListener("click", function () {
        document.getElementById("crearRol").style.display = "none";
        document.getElementById("formRol").reset();
    });

    document.getElementById("formRol").addEventListener("submit", function (e) {
        e.preventDefault();
        var nombre = document.getElementById("nombre").value;
        var descripcion = document.getElementById("descripcion").value;

        if (!nombre.trim()) {
            alert("Debe ingresar un nombre para el rol.");
            return;
        }

        $.ajax({
            url: "/Rol/Crear",
            type: "POST",
            data: { nombre: nombre, descripcion: descripcion },
            success: function (res) {
                alert(res.message);
                if (res.success) location.reload();
            },
            error: function () {
                alert("Error al intentar crear el rol.");
            }
        });
    });

    document.addEventListener("click", function (e) {
        if (!e.target.classList.contains("btnEliminar")) return;

        if (!confirm("¿Seguro que deseas eliminar este rol?")) return;

        var id = e.target.getAttribute("data-id");
        $.ajax({
            url: "/Rol/Eliminar",
            type: "POST",
            data: { id: id },
            success: function (res) {
                alert(res.message);
                if (res.success) location.reload();
            },
            error: function () {
                alert("Error al eliminar el rol.");
            }
        });
    });
</script>
